<h2 class="content-subhead">ASM</h2><p>可以使用 Tool <a href="https://gcc.godbolt.org/">godbolt</a> 得到組譯結果。稍微修改一下就能嵌入 C 裡，特別小心作業系統架構，符合才能運行，同時也要避免編譯時期最佳化 <code>-O2</code>, <code>-O1</code> ... 等造成的影響。</p>
<pre><code><div id="highlighter_248465" class="syntaxhighlighter nogutter  "><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="preprocessor">#include &lt;stdio.h></code></div><div class="line number2 index1 alt1"><code class="keyword bold">volatile</code> <code class="keyword bold">void</code> <code class="plain">asm_solver(</code><code class="keyword bold">volatile</code> <code class="color1 bold">int</code> <code class="plain">h, </code><code class="keyword bold">volatile</code> <code class="color1 bold">int</code> <code class="plain">w, </code><code class="keyword bold">volatile</code> <code class="color1 bold">int</code> <code class="plain">d) {</code></div><div class="line number3 index2 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">volatile</code> <code class="color1 bold">int</code> <code class="plain">area;</code></div><div class="line number4 index3 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">volatile</code> <code class="color1 bold">int</code> <code class="plain">volume;</code></div><div class="line number5 index4 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">__asm__ __volatile__(</code></div><div class="line number6 index5 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* (h+d)*w => edx */</code></div><div class="line number7 index6 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp;&nbsp; %1&nbsp;&nbsp; , %%edx\n\t"</code></div><div class="line number8 index7 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp;&nbsp; %3&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number9 index8 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"addl&nbsp;&nbsp;&nbsp; %%edx, %%eax\n\t"</code></div><div class="line number10 index9 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"imull&nbsp;&nbsp;&nbsp; %2&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number11 index10 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp;&nbsp; %%eax, %%edx\n\t"</code></div><div class="line number12 index11 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* h*d => eax, eax + edx => (h+d)*w+h*d*/</code></div><div class="line number13 index12 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp;&nbsp; %3&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number14 index13 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"imull&nbsp;&nbsp;&nbsp; %1&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number15 index14 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"addl&nbsp;&nbsp;&nbsp; %%edx, %%eax\n\t"</code></div><div class="line number16 index15 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="comments">/* ((h+d)*w+h*d) * 2 */</code></div><div class="line number17 index16 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"addl&nbsp;&nbsp;&nbsp; %%eax, %%eax\n\t"</code></div><div class="line number18 index17 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp; %%eax, %0\n\t"</code></div><div class="line number19 index18 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"=m"</code><code class="plain">(area) </code></div><div class="line number20 index19 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"m"</code><code class="plain">(h), </code><code class="string">"m"</code><code class="plain">(w), </code><code class="string">"m"</code><code class="plain">(d)</code></div><div class="line number21 index20 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"memory"</code><code class="plain">);</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">__asm__ __volatile__(</code></div><div class="line number24 index23 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp;&nbsp; %1&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number25 index24 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"imull&nbsp; %2&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number26 index25 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"imull&nbsp; %3&nbsp;&nbsp; , %%eax\n\t"</code></div><div class="line number27 index26 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="string">"movl&nbsp;&nbsp; %%eax, %0"</code></div><div class="line number28 index27 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"=m"</code><code class="plain">(volume) </code></div><div class="line number29 index28 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"m"</code><code class="plain">(h), </code><code class="string">"m"</code><code class="plain">(w), </code><code class="string">"m"</code><code class="plain">(d)</code></div><div class="line number30 index29 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">: </code><code class="string">"memory"</code><code class="plain">);</code></div><div class="line number31 index30 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions bold">printf</code><code class="plain">(</code><code class="string">"%d\n%d\n"</code><code class="plain">, area, volume);</code></div><div class="line number32 index31 alt1"><code class="plain">}</code></div><div class="line number33 index32 alt2"><code class="color1 bold">int</code> <code class="plain">main() {</code></div><div class="line number34 index33 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="color1 bold">int</code> <code class="plain">h, w, d;</code></div><div class="line number35 index34 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="functions bold">scanf</code><code class="plain">(</code><code class="string">"%d %d %d"</code><code class="plain">,&h, &w, &d);</code></div><div class="line number36 index35 alt1"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">asm_solver(h, w, d);</code></div><div class="line number37 index36 alt2"><code class="undefined spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">return</code> <code class="plain">0;</code></div><div class="line number38 index37 alt1"><code class="plain">}</code></div></div></td></tr></tbody></table></div>
</code></pre>